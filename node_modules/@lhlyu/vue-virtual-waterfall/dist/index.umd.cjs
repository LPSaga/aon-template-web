(function(f,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(f=typeof globalThis!="undefined"?globalThis:f||self,e(f.VueVirtualWaterfall={},f.Vue))})(this,function(f,e){"use strict";var ee=Object.defineProperty;var B=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var L=(f,e,v)=>e in f?ee(f,e,{enumerable:!0,configurable:!0,writable:!0,value:v}):f[e]=v,N=(f,e)=>{for(var v in e||(e={}))V.call(e,v)&&L(f,v,e[v]);if(B)for(var v of B(e))H.call(e,v)&&L(f,v,e[v]);return f};var z=(f,e)=>{var v={};for(var y in f)V.call(f,y)&&e.indexOf(y)<0&&(v[y]=f[y]);if(f!=null&&B)for(var y of B(f))e.indexOf(y)<0&&H.call(f,y)&&(v[y]=f[y]);return v};function v(t){return e.getCurrentScope()?(e.onScopeDispose(t),!0):!1}function y(t){return typeof t=="function"?t():e.unref(t)}const F=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const P=t=>t!=null,G=Object.prototype.toString,D=t=>G.call(t)==="[object Object]",K=()=>{};function q(t){return t||e.getCurrentInstance()}function T(t,n=!0,l){q()?e.onMounted(t,l):n?t():e.nextTick(t)}function x(t){var n;const l=y(t);return(n=l==null?void 0:l.$el)!=null?n:l}const O=F?window:void 0;function _(...t){let n,l,u,b;if(typeof t[0]=="string"||Array.isArray(t[0])?([l,u,b]=t,n=O):[n,l,u,b]=t,!n)return K;Array.isArray(l)||(l=[l]),Array.isArray(u)||(u=[u]);const d=[],c=()=>{d.forEach(m=>m()),d.length=0},a=(m,i,o,s)=>(m.addEventListener(i,o,s),()=>m.removeEventListener(i,o,s)),g=e.watch(()=>[x(n),y(b)],([m,i])=>{if(c(),!m)return;const o=D(i)?N({},i):i;d.push(...l.flatMap(s=>u.map(r=>a(m,s,r,o))))},{immediate:!0,flush:"post"}),p=()=>{g(),c()};return v(p),p}function U(){const t=e.ref(!1),n=e.getCurrentInstance();return n&&e.onMounted(()=>{t.value=!0},n),t}function I(t){const n=U();return e.computed(()=>(n.value,!!t()))}function J(t,n,l={}){const o=l,{window:u=O}=o,b=z(o,["window"]);let d;const c=I(()=>u&&"MutationObserver"in u),a=()=>{d&&(d.disconnect(),d=void 0)},g=e.computed(()=>{const s=y(t),r=(Array.isArray(s)?s:[s]).map(x).filter(P);return new Set(r)}),p=e.watch(()=>g.value,s=>{a(),c.value&&u&&s.size&&(d=new MutationObserver(n),s.forEach(r=>d.observe(r,b)))},{immediate:!0,flush:"post"}),m=()=>d==null?void 0:d.takeRecords(),i=()=>{a(),p()};return v(i),{isSupported:c,stop:i,takeRecords:m}}function j(t,n,l={}){const i=l,{window:u=O}=i,b=z(i,["window"]);let d;const c=I(()=>u&&"ResizeObserver"in u),a=()=>{d&&(d.disconnect(),d=void 0)},g=e.computed(()=>Array.isArray(t)?t.map(o=>x(o)):[x(t)]),p=e.watch(g,o=>{if(a(),c.value&&u){d=new ResizeObserver(n);for(const s of o)s&&d.observe(s,b)}},{immediate:!0,flush:"post"}),m=()=>{a(),p()};return v(m),{isSupported:c,stop:m}}function Q(t,n={}){const{reset:l=!0,windowResize:u=!0,windowScroll:b=!0,immediate:d=!0}=n,c=e.ref(0),a=e.ref(0),g=e.ref(0),p=e.ref(0),m=e.ref(0),i=e.ref(0),o=e.ref(0),s=e.ref(0);function r(){const w=x(t);if(!w){l&&(c.value=0,a.value=0,g.value=0,p.value=0,m.value=0,i.value=0,o.value=0,s.value=0);return}const h=w.getBoundingClientRect();c.value=h.height,a.value=h.bottom,g.value=h.left,p.value=h.right,m.value=h.top,i.value=h.width,o.value=h.x,s.value=h.y}return j(t,r),e.watch(()=>x(t),w=>!w&&r()),J(t,r,{attributeFilter:["style","class"]}),b&&_("scroll",r,{capture:!0,passive:!0}),u&&_("resize",r,{passive:!0}),T(()=>{d&&r()}),{height:c,bottom:a,left:g,right:p,top:m,width:i,x:o,y:s,update:r}}function X(t,n={width:0,height:0},l={}){const{window:u=O,box:b="content-box"}=l,d=e.computed(()=>{var i,o;return(o=(i=x(t))==null?void 0:i.namespaceURI)==null?void 0:o.includes("svg")}),c=e.ref(n.width),a=e.ref(n.height),{stop:g}=j(t,([i])=>{const o=b==="border-box"?i.borderBoxSize:b==="content-box"?i.contentBoxSize:i.devicePixelContentBoxSize;if(u&&d.value){const s=x(t);if(s){const r=u.getComputedStyle(s);c.value=Number.parseFloat(r.width),a.value=Number.parseFloat(r.height)}}else if(o){const s=Array.isArray(o)?o:[o];c.value=s.reduce((r,{inlineSize:w})=>r+w,0),a.value=s.reduce((r,{blockSize:w})=>r+w,0)}else c.value=i.contentRect.width,a.value=i.contentRect.height},l);T(()=>{const i=x(t);i&&(c.value="offsetWidth"in i?i.offsetWidth:n.width,a.value="offsetHeight"in i?i.offsetHeight:n.height)});const p=e.watch(()=>x(t),i=>{c.value=i?n.width:0,a.value=i?n.height:0});function m(){g(),p()}return{width:c,height:a,stop:m}}const Y=["data-index"],E=e.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{virtual:{type:Boolean,default:!0},rowKey:{default:"id"},gap:{default:15},padding:{default:15},preloadScreenCount:{default:()=>[0,0]},itemMinWidth:{default:220},maxColumnCount:{default:10},minColumnCount:{default:2},items:{default:()=>[]},calcItemHeight:{type:Function,default:(t,n)=>250}},setup(t){const n=t;e.useSlots();const l=e.ref(),{width:u}=X(l),{top:b}=Q(l);e.onMounted(()=>{u.value===0&&(u.value=Number.parseInt(window.getComputedStyle(l.value).width))});function d(o){return Object.prototype.toString.call(o)==="[object Number]"}const c=e.computed(()=>{if(!u.value)return 0;const o=u.value;if(o>=n.itemMinWidth*2){const s=Math.floor(o/n.itemMinWidth);return n.maxColumnCount&&s>n.maxColumnCount?n.maxColumnCount:s}return n.minColumnCount}),a=e.ref(new Array(c.value).fill(0)),g=e.computed(()=>{if(!u.value||c.value<=0)return 0;const o=(c.value-1)*n.gap;return Math.ceil((u.value-o)/c.value)}),p=e.ref([]);e.watchEffect(()=>{if(!c.value){p.value=[];return}const o=n.items.length,s=new Array(o);let r=0;const w=p.value.length&&o>p.value.length;w?r=p.value.length:a.value=new Array(c.value).fill(0);for(let h=0;h<o;h++){if(w&&h<r){s[h]=p.value[h];continue}const C=i(),S=n.calcItemHeight(n.items[h],g.value),M=a.value[C],A=(g.value+n.gap)*C,W={index:h,item:n.items[h],column:C,top:M,left:A,bottom:M+S,height:S};a.value[C]+=S+n.gap,s[h]=W}p.value=s});const m=e.computed(()=>{const o=p.value.length;if(!o)return[];if(!n.virtual)return p.value;const s=l.value.parentElement.offsetTop,r=-b.value+s,[w,h]=n.preloadScreenCount,C=l.value.parentElement.clientHeight,S=r-w*C,M=r+(h+1)*C,A=[];for(let W=0;W<o;W++){const k=p.value[W],R=k.top,$=k.bottom;(R>=S&&R<=M||$>=S&&$<=M||R<S&&$>M)&&A.push(k)}return A}),i=()=>a.value.indexOf(Math.min(...a.value));return(o,s)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"content",ref:l,style:e.normalizeStyle({position:"relative",willChange:"height",height:`${Math.max(...a.value)}px`,padding:`${d(o.padding)?o.padding+"px":o.padding}`})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,r=>{var w;return e.openBlock(),e.createElementBlock("div",{key:(w=r.item[o.rowKey])!=null?w:r.index,style:e.normalizeStyle({position:"absolute",contentVisibility:"auto",width:`${g.value}px`,height:`${r.height}px`,transform:`translate(${r.left}px, ${r.top}px)`,containIntrinsicSize:`${g.value}px ${r.height}px`}),"data-index":r.index},[e.renderSlot(o.$slots,"default",{item:r.item,index:r.index})],12,Y)}),128))],4))}}),Z={install(t){t.component(E.name,E)}};f.VirtualWaterfall=E,f.default=Z,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
