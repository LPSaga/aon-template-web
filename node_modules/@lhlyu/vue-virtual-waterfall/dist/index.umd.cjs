(function(f,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(f=typeof globalThis!="undefined"?globalThis:f||self,e(f.VueVirtualWaterfall={},f.Vue))})(this,function(f,e){"use strict";var ee=Object.defineProperty;var B=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var L=(f,e,v)=>e in f?ee(f,e,{enumerable:!0,configurable:!0,writable:!0,value:v}):f[e]=v,F=(f,e)=>{for(var v in e||(e={}))V.call(e,v)&&L(f,v,e[v]);if(B)for(var v of B(e))H.call(e,v)&&L(f,v,e[v]);return f};var _=(f,e)=>{var v={};for(var b in f)V.call(f,b)&&e.indexOf(b)<0&&(v[b]=f[b]);if(f!=null&&B)for(var b of B(f))e.indexOf(b)<0&&H.call(f,b)&&(v[b]=f[b]);return v};function v(t){return e.getCurrentScope()?(e.onScopeDispose(t),!0):!1}function b(t){return typeof t=="function"?t():e.unref(t)}const N=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const P=t=>t!=null,G=Object.prototype.toString,q=t=>G.call(t)==="[object Object]",D=()=>{};function K(t){return e.getCurrentInstance()}function $(t,o=!0,l){K()?e.onMounted(t,l):o?t():e.nextTick(t)}function S(t){var o;const l=b(t);return(o=l==null?void 0:l.$el)!=null?o:l}const A=N?window:void 0;function z(...t){let o,l,c,y;if(typeof t[0]=="string"||Array.isArray(t[0])?([l,c,y]=t,o=A):[o,l,c,y]=t,!o)return D;Array.isArray(l)||(l=[l]),Array.isArray(c)||(c=[c]);const d=[],u=()=>{d.forEach(m=>m()),d.length=0},a=(m,i,n,r)=>(m.addEventListener(i,n,r),()=>m.removeEventListener(i,n,r)),g=e.watch(()=>[S(o),b(y)],([m,i])=>{if(u(),!m)return;const n=q(i)?F({},i):i;d.push(...l.flatMap(r=>c.map(s=>a(m,r,s,n))))},{immediate:!0,flush:"post"}),p=()=>{g(),u()};return v(p),p}function U(){const t=e.ref(!1),o=e.getCurrentInstance();return o&&e.onMounted(()=>{t.value=!0},o),t}function I(t){const o=U();return e.computed(()=>(o.value,!!t()))}function J(t,o,l={}){const n=l,{window:c=A}=n,y=_(n,["window"]);let d;const u=I(()=>c&&"MutationObserver"in c),a=()=>{d&&(d.disconnect(),d=void 0)},g=e.computed(()=>{const r=b(t),s=(Array.isArray(r)?r:[r]).map(S).filter(P);return new Set(s)}),p=e.watch(()=>g.value,r=>{a(),u.value&&r.size&&(d=new MutationObserver(o),r.forEach(s=>d.observe(s,y)))},{immediate:!0,flush:"post"}),m=()=>d==null?void 0:d.takeRecords(),i=()=>{p(),a()};return v(i),{isSupported:u,stop:i,takeRecords:m}}function j(t,o,l={}){const i=l,{window:c=A}=i,y=_(i,["window"]);let d;const u=I(()=>c&&"ResizeObserver"in c),a=()=>{d&&(d.disconnect(),d=void 0)},g=e.computed(()=>{const n=b(t);return Array.isArray(n)?n.map(r=>S(r)):[S(n)]}),p=e.watch(g,n=>{if(a(),u.value&&c){d=new ResizeObserver(o);for(const r of n)r&&d.observe(r,y)}},{immediate:!0,flush:"post"}),m=()=>{a(),p()};return v(m),{isSupported:u,stop:m}}function Q(t,o={}){const{reset:l=!0,windowResize:c=!0,windowScroll:y=!0,immediate:d=!0,updateTiming:u="sync"}=o,a=e.ref(0),g=e.ref(0),p=e.ref(0),m=e.ref(0),i=e.ref(0),n=e.ref(0),r=e.ref(0),s=e.ref(0);function x(){const C=S(t);if(!C){l&&(a.value=0,g.value=0,p.value=0,m.value=0,i.value=0,n.value=0,r.value=0,s.value=0);return}const w=C.getBoundingClientRect();a.value=w.height,g.value=w.bottom,p.value=w.left,m.value=w.right,i.value=w.top,n.value=w.width,r.value=w.x,s.value=w.y}function h(){u==="sync"?x():u==="next-frame"&&requestAnimationFrame(()=>x())}return j(t,h),e.watch(()=>S(t),C=>!C&&h()),J(t,h,{attributeFilter:["style","class"]}),y&&z("scroll",h,{capture:!0,passive:!0}),c&&z("resize",h,{passive:!0}),$(()=>{d&&h()}),{height:a,bottom:g,left:p,right:m,top:i,width:n,x:r,y:s,update:h}}function X(t,o={width:0,height:0},l={}){const{window:c=A,box:y="content-box"}=l,d=e.computed(()=>{var i,n;return(n=(i=S(t))==null?void 0:i.namespaceURI)==null?void 0:n.includes("svg")}),u=e.ref(o.width),a=e.ref(o.height),{stop:g}=j(t,([i])=>{const n=y==="border-box"?i.borderBoxSize:y==="content-box"?i.contentBoxSize:i.devicePixelContentBoxSize;if(c&&d.value){const r=S(t);if(r){const s=r.getBoundingClientRect();u.value=s.width,a.value=s.height}}else if(n){const r=Array.isArray(n)?n:[n];u.value=r.reduce((s,{inlineSize:x})=>s+x,0),a.value=r.reduce((s,{blockSize:x})=>s+x,0)}else u.value=i.contentRect.width,a.value=i.contentRect.height},l);$(()=>{const i=S(t);i&&(u.value="offsetWidth"in i?i.offsetWidth:o.width,a.value="offsetHeight"in i?i.offsetHeight:o.height)});const p=e.watch(()=>S(t),i=>{u.value=i?o.width:0,a.value=i?o.height:0});function m(){g(),p()}return{width:u,height:a,stop:m}}const Y=["data-index"],E=e.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{virtual:{type:Boolean,default:!0},rowKey:{default:"id"},gap:{default:15},padding:{default:15},preloadScreenCount:{default:()=>[0,0]},itemMinWidth:{default:220},maxColumnCount:{default:10},minColumnCount:{default:2},items:{default:()=>[]},calcItemHeight:{type:Function,default:(t,o)=>250}},setup(t){const o=t,l=e.ref(),{width:c}=X(l),{top:y}=Q(l);e.onMounted(()=>{c.value===0&&(c.value=Number.parseInt(window.getComputedStyle(l.value).width))});function d(n){return Object.prototype.toString.call(n)==="[object Number]"}const u=e.computed(()=>{if(!c.value)return 0;const n=c.value;if(n>=o.itemMinWidth*2){const r=Math.floor(n/o.itemMinWidth);return o.maxColumnCount&&r>o.maxColumnCount?o.maxColumnCount:r}return o.minColumnCount}),a=e.ref(new Array(u.value).fill(0)),g=e.computed(()=>{if(!c.value||u.value<=0)return 0;const n=(u.value-1)*o.gap;return Math.ceil((c.value-n)/u.value)}),p=e.shallowRef([]);e.watchEffect(()=>{if(!u.value){p.value=[];return}const n=o.items.length,r=new Array(n);let s=0;const x=p.value.length&&n>p.value.length;x?s=p.value.length:a.value=new Array(u.value).fill(0);for(let h=0;h<n;h++){if(x&&h<s){r[h]=p.value[h];continue}const C=i(),w=o.calcItemHeight(o.items[h],g.value),M=a.value[C],O=(g.value+o.gap)*C,W={index:h,item:o.items[h],column:C,top:M,left:O,bottom:M+w,height:w};a.value[C]+=w+o.gap,r[h]=W}p.value=r});const m=e.computed(()=>{const n=p.value.length;if(!n)return[];if(!o.virtual)return p.value;const r=l.value.parentElement.offsetTop,s=-y.value+r,[x,h]=o.preloadScreenCount,C=l.value.parentElement.clientHeight,w=s-x*C,M=s+(h+1)*C,O=[];for(let W=0;W<n;W++){const k=p.value[W],R=k.top,T=k.bottom;(R>=w&&R<=M||T>=w&&T<=M||R<w&&T>M)&&O.push(k)}return O}),i=()=>a.value.indexOf(Math.min(...a.value));return(n,r)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"content",ref:l,style:e.normalizeStyle({position:"relative",willChange:"height",height:`${Math.max(...a.value)}px`,padding:`${d(n.padding)?n.padding+"px":n.padding}`})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,s=>{var x;return e.openBlock(),e.createElementBlock("div",{key:(x=s.item[n.rowKey])!=null?x:s.index,style:e.normalizeStyle({position:"absolute",contentVisibility:"auto",width:`${g.value}px`,height:`${s.height}px`,transform:`translate(${s.left}px, ${s.top}px)`,containIntrinsicSize:`${g.value}px ${s.height}px`}),"data-index":s.index},[e.renderSlot(n.$slots,"default",{item:s.item,index:s.index})],12,Y)}),128))],4))}}),Z={install(t){t.component(E.name,E)}};f.VirtualWaterfall=E,f.default=Z,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
