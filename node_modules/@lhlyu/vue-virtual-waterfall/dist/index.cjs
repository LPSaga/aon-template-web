"use strict";var F=Object.defineProperty;var M=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var z=(e,t,o)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,L=(e,t)=>{for(var o in t||(t={}))_.call(t,o)&&z(e,o,t[o]);if(M)for(var o of M(t))I.call(t,o)&&z(e,o,t[o]);return e};var E=(e,t)=>{var o={};for(var i in e)_.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&M)for(var i of M(e))t.indexOf(i)<0&&I.call(e,i)&&(o[i]=e[i]);return o};Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("vue");function R(e){return n.getCurrentScope()?(n.onScopeDispose(e),!0):!1}function $(e){return typeof e=="function"?e():n.unref(e)}const V=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const P=e=>e!=null,G=Object.prototype.toString,D=e=>G.call(e)==="[object Object]",K=()=>{};function q(e){return e||n.getCurrentInstance()}function j(e,t=!0,o){q()?n.onMounted(e,o):t?e():n.nextTick(e)}function w(e){var t;const o=$(e);return(t=o==null?void 0:o.$el)!=null?t:o}const W=V?window:void 0;function T(...e){let t,o,i,g;if(typeof e[0]=="string"||Array.isArray(e[0])?([o,i,g]=e,t=W):[t,o,i,g]=e,!t)return K;Array.isArray(o)||(o=[o]),Array.isArray(i)||(i=[i]);const f=[],c=()=>{f.forEach(p=>p()),f.length=0},a=(p,r,u,s)=>(p.addEventListener(r,u,s),()=>p.removeEventListener(r,u,s)),m=n.watch(()=>[w(t),$(g)],([p,r])=>{if(c(),!p)return;const u=D(r)?L({},r):r;f.push(...o.flatMap(s=>i.map(l=>a(p,s,l,u))))},{immediate:!0,flush:"post"}),d=()=>{m(),c()};return R(d),d}function U(){const e=n.ref(!1),t=n.getCurrentInstance();return t&&n.onMounted(()=>{e.value=!0},t),e}function H(e){const t=U();return n.computed(()=>(t.value,!!e()))}function J(e,t,o={}){const u=o,{window:i=W}=u,g=E(u,["window"]);let f;const c=H(()=>i&&"MutationObserver"in i),a=()=>{f&&(f.disconnect(),f=void 0)},m=n.computed(()=>{const s=$(e),l=(Array.isArray(s)?s:[s]).map(w).filter(P);return new Set(l)}),d=n.watch(()=>m.value,s=>{a(),c.value&&i&&s.size&&(f=new MutationObserver(t),s.forEach(l=>f.observe(l,g)))},{immediate:!0,flush:"post"}),p=()=>f==null?void 0:f.takeRecords(),r=()=>{a(),d()};return R(r),{isSupported:c,stop:r,takeRecords:p}}function N(e,t,o={}){const r=o,{window:i=W}=r,g=E(r,["window"]);let f;const c=H(()=>i&&"ResizeObserver"in i),a=()=>{f&&(f.disconnect(),f=void 0)},m=n.computed(()=>Array.isArray(e)?e.map(u=>w(u)):[w(e)]),d=n.watch(m,u=>{if(a(),c.value&&i){f=new ResizeObserver(t);for(const s of u)s&&f.observe(s,g)}},{immediate:!0,flush:"post"}),p=()=>{a(),d()};return R(p),{isSupported:c,stop:p}}function Q(e,t={}){const{reset:o=!0,windowResize:i=!0,windowScroll:g=!0,immediate:f=!0}=t,c=n.ref(0),a=n.ref(0),m=n.ref(0),d=n.ref(0),p=n.ref(0),r=n.ref(0),u=n.ref(0),s=n.ref(0);function l(){const h=w(e);if(!h){o&&(c.value=0,a.value=0,m.value=0,d.value=0,p.value=0,r.value=0,u.value=0,s.value=0);return}const v=h.getBoundingClientRect();c.value=v.height,a.value=v.bottom,m.value=v.left,d.value=v.right,p.value=v.top,r.value=v.width,u.value=v.x,s.value=v.y}return N(e,l),n.watch(()=>w(e),h=>!h&&l()),J(e,l,{attributeFilter:["style","class"]}),g&&T("scroll",l,{capture:!0,passive:!0}),i&&T("resize",l,{passive:!0}),j(()=>{f&&l()}),{height:c,bottom:a,left:m,right:d,top:p,width:r,x:u,y:s,update:l}}function X(e,t={width:0,height:0},o={}){const{window:i=W,box:g="content-box"}=o,f=n.computed(()=>{var r,u;return(u=(r=w(e))==null?void 0:r.namespaceURI)==null?void 0:u.includes("svg")}),c=n.ref(t.width),a=n.ref(t.height),{stop:m}=N(e,([r])=>{const u=g==="border-box"?r.borderBoxSize:g==="content-box"?r.contentBoxSize:r.devicePixelContentBoxSize;if(i&&f.value){const s=w(e);if(s){const l=i.getComputedStyle(s);c.value=Number.parseFloat(l.width),a.value=Number.parseFloat(l.height)}}else if(u){const s=Array.isArray(u)?u:[u];c.value=s.reduce((l,{inlineSize:h})=>l+h,0),a.value=s.reduce((l,{blockSize:h})=>l+h,0)}else c.value=r.contentRect.width,a.value=r.contentRect.height},o);j(()=>{const r=w(e);r&&(c.value="offsetWidth"in r?r.offsetWidth:t.width,a.value="offsetHeight"in r?r.offsetHeight:t.height)});const d=n.watch(()=>w(e),r=>{c.value=r?t.width:0,a.value=r?t.height:0});function p(){m(),d()}return{width:c,height:a,stop:p}}const Y=["data-index"],k=n.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{virtual:{type:Boolean,default:!0},rowKey:{default:"id"},gap:{default:15},padding:{default:15},preloadScreenCount:{default:()=>[0,0]},itemMinWidth:{default:220},maxColumnCount:{default:10},minColumnCount:{default:2},items:{default:()=>[]},calcItemHeight:{type:Function,default:(e,t)=>250}},setup(e){const t=e;n.useSlots();const o=n.ref(),{width:i}=X(o),{top:g}=Q(o);n.onMounted(()=>{i.value===0&&(i.value=Number.parseInt(window.getComputedStyle(o.value).width))});function f(u){return Object.prototype.toString.call(u)==="[object Number]"}const c=n.computed(()=>{if(!i.value)return 0;const u=i.value;if(u>=t.itemMinWidth*2){const s=Math.floor(u/t.itemMinWidth);return t.maxColumnCount&&s>t.maxColumnCount?t.maxColumnCount:s}return t.minColumnCount}),a=n.ref(new Array(c.value).fill(0)),m=n.computed(()=>{if(!i.value||c.value<=0)return 0;const u=(c.value-1)*t.gap;return Math.ceil((i.value-u)/c.value)}),d=n.ref([]);n.watchEffect(()=>{if(!c.value){d.value=[];return}const u=t.items.length,s=new Array(u);let l=0;const h=d.value.length&&u>d.value.length;h?l=d.value.length:a.value=new Array(c.value).fill(0);for(let v=0;v<u;v++){if(h&&v<l){s[v]=d.value[v];continue}const b=r(),y=t.calcItemHeight(t.items[v],m.value),x=a.value[b],S=(m.value+t.gap)*b,C={index:v,item:t.items[v],column:b,top:x,left:S,bottom:x+y,height:y};a.value[b]+=y+t.gap,s[v]=C}d.value=s});const p=n.computed(()=>{const u=d.value.length;if(!u)return[];if(!t.virtual)return d.value;const s=o.value.parentElement.offsetTop,l=-g.value+s,[h,v]=t.preloadScreenCount,b=o.value.parentElement.clientHeight,y=l-h*b,x=l+(v+1)*b,S=[];for(let C=0;C<u;C++){const O=d.value[C],A=O.top,B=O.bottom;(A>=y&&A<=x||B>=y&&B<=x||A<y&&B>x)&&S.push(O)}return S}),r=()=>a.value.indexOf(Math.min(...a.value));return(u,s)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"content",ref:o,style:n.normalizeStyle({position:"relative",willChange:"height",height:`${Math.max(...a.value)}px`,padding:`${f(u.padding)?u.padding+"px":u.padding}`})},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(p.value,l=>{var h;return n.openBlock(),n.createElementBlock("div",{key:(h=l.item[u.rowKey])!=null?h:l.index,style:n.normalizeStyle({position:"absolute",contentVisibility:"auto",width:`${m.value}px`,height:`${l.height}px`,transform:`translate(${l.left}px, ${l.top}px)`,containIntrinsicSize:`${m.value}px ${l.height}px`}),"data-index":l.index},[n.renderSlot(u.$slots,"default",{item:l.item,index:l.index})],12,Y)}),128))],4))}}),Z={install(e){e.component(k.name,k)}};exports.VirtualWaterfall=k;exports.default=Z;
