"use strict";var F=Object.defineProperty;var M=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var $=(e,t,i)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,T=(e,t)=>{for(var i in t||(t={}))z.call(t,i)&&$(e,i,t[i]);if(M)for(var i of M(t))I.call(t,i)&&$(e,i,t[i]);return e};var k=(e,t)=>{var i={};for(var l in e)z.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(e!=null&&M)for(var l of M(e))t.indexOf(l)<0&&I.call(e,l)&&(i[l]=e[l]);return i};Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("vue");function _(e){return n.getCurrentScope()?(n.onScopeDispose(e),!0):!1}function W(e){return typeof e=="function"?e():n.unref(e)}const N=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const P=e=>e!=null,G=Object.prototype.toString,q=e=>G.call(e)==="[object Object]",D=()=>{};function K(e){return n.getCurrentInstance()}function j(e,t=!0,i){K()?n.onMounted(e,i):t?e():n.nextTick(e)}function y(e){var t;const i=W(e);return(t=i==null?void 0:i.$el)!=null?t:i}const A=N?window:void 0;function L(...e){let t,i,l,g;if(typeof e[0]=="string"||Array.isArray(e[0])?([i,l,g]=e,t=A):[t,i,l,g]=e,!t)return D;Array.isArray(i)||(i=[i]),Array.isArray(l)||(l=[l]);const f=[],c=()=>{f.forEach(p=>p()),f.length=0},a=(p,u,o,r)=>(p.addEventListener(u,o,r),()=>p.removeEventListener(u,o,r)),m=n.watch(()=>[y(t),W(g)],([p,u])=>{if(c(),!p)return;const o=q(u)?T({},u):u;f.push(...i.flatMap(r=>l.map(s=>a(p,r,s,o))))},{immediate:!0,flush:"post"}),d=()=>{m(),c()};return _(d),d}function U(){const e=n.ref(!1),t=n.getCurrentInstance();return t&&n.onMounted(()=>{e.value=!0},t),e}function H(e){const t=U();return n.computed(()=>(t.value,!!e()))}function J(e,t,i={}){const o=i,{window:l=A}=o,g=k(o,["window"]);let f;const c=H(()=>l&&"MutationObserver"in l),a=()=>{f&&(f.disconnect(),f=void 0)},m=n.computed(()=>{const r=W(e),s=(Array.isArray(r)?r:[r]).map(y).filter(P);return new Set(s)}),d=n.watch(()=>m.value,r=>{a(),c.value&&r.size&&(f=new MutationObserver(t),r.forEach(s=>f.observe(s,g)))},{immediate:!0,flush:"post"}),p=()=>f==null?void 0:f.takeRecords(),u=()=>{d(),a()};return _(u),{isSupported:c,stop:u,takeRecords:p}}function V(e,t,i={}){const u=i,{window:l=A}=u,g=k(u,["window"]);let f;const c=H(()=>l&&"ResizeObserver"in l),a=()=>{f&&(f.disconnect(),f=void 0)},m=n.computed(()=>{const o=W(e);return Array.isArray(o)?o.map(r=>y(r)):[y(o)]}),d=n.watch(m,o=>{if(a(),c.value&&l){f=new ResizeObserver(t);for(const r of o)r&&f.observe(r,g)}},{immediate:!0,flush:"post"}),p=()=>{a(),d()};return _(p),{isSupported:c,stop:p}}function Q(e,t={}){const{reset:i=!0,windowResize:l=!0,windowScroll:g=!0,immediate:f=!0,updateTiming:c="sync"}=t,a=n.ref(0),m=n.ref(0),d=n.ref(0),p=n.ref(0),u=n.ref(0),o=n.ref(0),r=n.ref(0),s=n.ref(0);function w(){const b=y(e);if(!b){i&&(a.value=0,m.value=0,d.value=0,p.value=0,u.value=0,o.value=0,r.value=0,s.value=0);return}const h=b.getBoundingClientRect();a.value=h.height,m.value=h.bottom,d.value=h.left,p.value=h.right,u.value=h.top,o.value=h.width,r.value=h.x,s.value=h.y}function v(){c==="sync"?w():c==="next-frame"&&requestAnimationFrame(()=>w())}return V(e,v),n.watch(()=>y(e),b=>!b&&v()),J(e,v,{attributeFilter:["style","class"]}),g&&L("scroll",v,{capture:!0,passive:!0}),l&&L("resize",v,{passive:!0}),j(()=>{f&&v()}),{height:a,bottom:m,left:d,right:p,top:u,width:o,x:r,y:s,update:v}}function X(e,t={width:0,height:0},i={}){const{window:l=A,box:g="content-box"}=i,f=n.computed(()=>{var u,o;return(o=(u=y(e))==null?void 0:u.namespaceURI)==null?void 0:o.includes("svg")}),c=n.ref(t.width),a=n.ref(t.height),{stop:m}=V(e,([u])=>{const o=g==="border-box"?u.borderBoxSize:g==="content-box"?u.contentBoxSize:u.devicePixelContentBoxSize;if(l&&f.value){const r=y(e);if(r){const s=r.getBoundingClientRect();c.value=s.width,a.value=s.height}}else if(o){const r=Array.isArray(o)?o:[o];c.value=r.reduce((s,{inlineSize:w})=>s+w,0),a.value=r.reduce((s,{blockSize:w})=>s+w,0)}else c.value=u.contentRect.width,a.value=u.contentRect.height},i);j(()=>{const u=y(e);u&&(c.value="offsetWidth"in u?u.offsetWidth:t.width,a.value="offsetHeight"in u?u.offsetHeight:t.height)});const d=n.watch(()=>y(e),u=>{c.value=u?t.width:0,a.value=u?t.height:0});function p(){m(),d()}return{width:c,height:a,stop:p}}const Y=["data-index"],R=n.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{virtual:{type:Boolean,default:!0},rowKey:{default:"id"},gap:{default:15},padding:{default:15},preloadScreenCount:{default:()=>[0,0]},itemMinWidth:{default:220},maxColumnCount:{default:10},minColumnCount:{default:2},items:{default:()=>[]},calcItemHeight:{type:Function,default:(e,t)=>250}},setup(e){const t=e,i=n.ref(),{width:l}=X(i),{top:g}=Q(i);n.onMounted(()=>{l.value===0&&(l.value=Number.parseInt(window.getComputedStyle(i.value).width))});function f(o){return Object.prototype.toString.call(o)==="[object Number]"}const c=n.computed(()=>{if(!l.value)return 0;const o=l.value;if(o>=t.itemMinWidth*2){const r=Math.floor(o/t.itemMinWidth);return t.maxColumnCount&&r>t.maxColumnCount?t.maxColumnCount:r}return t.minColumnCount}),a=n.ref(new Array(c.value).fill(0)),m=n.computed(()=>{if(!l.value||c.value<=0)return 0;const o=(c.value-1)*t.gap;return Math.ceil((l.value-o)/c.value)}),d=n.shallowRef([]);n.watchEffect(()=>{if(!c.value){d.value=[];return}const o=t.items.length,r=new Array(o);let s=0;const w=d.value.length&&o>d.value.length;w?s=d.value.length:a.value=new Array(c.value).fill(0);for(let v=0;v<o;v++){if(w&&v<s){r[v]=d.value[v];continue}const b=u(),h=t.calcItemHeight(t.items[v],m.value),x=a.value[b],S=(m.value+t.gap)*b,C={index:v,item:t.items[v],column:b,top:x,left:S,bottom:x+h,height:h};a.value[b]+=h+t.gap,r[v]=C}d.value=r});const p=n.computed(()=>{const o=d.value.length;if(!o)return[];if(!t.virtual)return d.value;const r=i.value.parentElement.offsetTop,s=-g.value+r,[w,v]=t.preloadScreenCount,b=i.value.parentElement.clientHeight,h=s-w*b,x=s+(v+1)*b,S=[];for(let C=0;C<o;C++){const O=d.value[C],B=O.top,E=O.bottom;(B>=h&&B<=x||E>=h&&E<=x||B<h&&E>x)&&S.push(O)}return S}),u=()=>a.value.indexOf(Math.min(...a.value));return(o,r)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"content",ref:i,style:n.normalizeStyle({position:"relative",willChange:"height",height:`${Math.max(...a.value)}px`,padding:`${f(o.padding)?o.padding+"px":o.padding}`})},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(p.value,s=>{var w;return n.openBlock(),n.createElementBlock("div",{key:(w=s.item[o.rowKey])!=null?w:s.index,style:n.normalizeStyle({position:"absolute",contentVisibility:"auto",width:`${m.value}px`,height:`${s.height}px`,transform:`translate(${s.left}px, ${s.top}px)`,containIntrinsicSize:`${m.value}px ${s.height}px`}),"data-index":s.index},[n.renderSlot(o.$slots,"default",{item:s.item,index:s.index})],12,Y)}),128))],4))}}),Z={install(e){e.component(R.name,R)}};exports.VirtualWaterfall=R;exports.default=Z;
